<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover, user-scalable=no, maximum-scale=1.0, minimum-scale=1.0">
    <title>ReConecta - No caigas en las redes</title>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700&display=swap" rel="stylesheet">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="theme-color" content="#0e58db">
    <link rel="manifest" href="data:application/manifest+json;base64,ewogICJuYW1lIjogIlJlQ29uZWN0YSAtIE5vIGNhaWdhcyBlbiBsYXMgcmVkZXMiLAogICJzaG9ydF9uYW1lIjogIlJlQ29uZWN0YSIsCiAgImRlc2NyaXB0aW9uIjogIkp1ZWdvIGRlIG1lbW9yaWEgcGFyYSBhcHJlbmRlciBzb2JyZSBzZWd1cmlkYWQgZGlnaXRhbCB5IGVtcHJlbmRpbWllbnRvLiIsCiAgInN0YXJ0X3VybCI6ICIuL2luZGV4Lmh0bWwiLAogICJkaXNwbGF5IjogInN0YW5kYWxvbmUiLAogICJiYWNrZ3JvdW5kX2NvbG9yIjogIiMwZTQ5YjYiLAogICJ0aGVtZV9jb2xvciI6ICIjMGU1ZGRiIiwKICAib3JpZW50YXRpb24iOiAicG9ydHJhaXQtcHJpbWFyeSIsCiAgImljb25zIjogWwogICAgewogICAgICAic3JjIjogImh0dHBzOi8vaW1hZ2VzNC5pbWFnZWJhbS5jb20vYzUvZDcvM2EvTUUxNUJGR0Ffby5wbmciLAogICAgICAic2l6ZXMiOiAiMTkyeDE5MiIsCiAgICAgICJ0eXBlIjogImltYWdlL3BuZyIKICAgIH0sCiAgICB7CiAgICAgICJzcmMiOiAiaHR0cHM6Ly9pbWFnZXM0LmltYWdlYmFtLmNvbS9jNS9kNy8zYS9NRTE1QkZHQV_vLnBuZyIsCiAgICAgICJzaXplcyI6ICI1MTJ4NTEyIiwKICAgICAgInR5cGUiOiAiaW1hZ2UvcG5nIgogICAgfQog IF0KfQ==">
    <style>
        :root {
            --primary-color: #488ce4;
            --secondary-color: #3a75c4;
            --background-start: #020617;
            --background-end: #1e293b;
            --card-bg: rgba(255, 255, 255, 0.05);
            --card-border: rgba(255, 255, 255, 0.1);
            --text-light: #f8fafc;
            --text-dark: #94a3b8;
            --shadow-light: rgba(139, 92, 246, 0.5);
            --shadow-dark: rgba(14, 88, 219, 0.5);
            --font-family: 'Poppins', sans-serif;
            --player1-color: #87CEFA;
            --player2-color: #90EE90;
        }

        *, *::before, *::after {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        html, body {
            width: 100%;
            height: 100dvh;
            overflow: hidden;
            font-family: var(--font-family);
            background: var(--background-start);
            color: var(--text-light);
            transition: background-color 0.5s ease-in-out;
        }
        
        body.menu-active {
            background: #488ce4;
        }
        
        body.menu-active .dynamic-gradient {
            background-color: transparent;
            opacity: 1;
            background: radial-gradient(circle at var(--x, 50%) var(--y, 50%), rgba(255,255,255,0.2), transparent 40%),
                        radial-gradient(circle at calc(100% - var(--x, 50%)) calc(100% - var(--y, 50%)), rgba(255,255,255,0.1), transparent 40%);
        }

        body {
            display: flex;
            justify-content: center;
            align-items: center;
            perspective: 1000px;
        }

        #particles-js {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: -2;
        }

        .dynamic-gradient {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: radial-gradient(circle at var(--x, 50%) var(--y, 50%), var(--primary-color), transparent 40%),
                        radial-gradient(circle at calc(100% - var(--x, 50%)) calc(100% - var(--y, 50%)), var(--secondary-color), transparent 40%);
            background-color: var(--background-start);
            opacity: 0.3;
            z-index: -1;
            transition: background 0.3s ease-out, opacity 0.3s ease-out;
        }

        .registration-screen, .main-menu, .game-screen, .win-screen, .modal {
            width: 100%;
            height: 100%;
            display: flex;
            flex-direction: column;
            align-items: center;
            text-align: center;
            padding: max(15px, env(safe-area-inset-top, 15px)) max(15px, env(safe-area-inset-right, 15px)) max(15px, env(safe-area-inset-bottom, 15px)) max(15px, env(safe-area-inset-left, 15px));
            position: absolute;
            top: 0;
            left: 0;
            transition: opacity 0.5s ease-out, transform 0.5s ease-out;
            justify-content: center;
        }
        
        .game-screen {
            justify-content: flex-start;
            gap: clamp(10px, 2vh, 20px);
        }

        .menu-content {
            background: rgba(0, 0, 0, 0.2);
            padding: clamp(20px, 5vw, 40px);
            border-radius: 20px;
            backdrop-filter: blur(10px);
            border: 1px solid var(--card-border);
            box-shadow: 0 8px 32px 0 rgba(0, 0, 0, 0.37);
            transform-style: preserve-3d;
            transform: translateZ(0);
            width: 90%;
            max-width: 450px;
        }
        
        #main-menu .menu-content {
            background: transparent;
            box-shadow: none;
            border: none;
            backdrop-filter: none;
        }

        .game-title {
            font-size: clamp(2.5rem, 8vw, 5rem);
            font-weight: 700;
            color: var(--text-light);
            margin-bottom: 0.2em;
            text-shadow: 0 0 15px var(--shadow-light);
        }

        .game-subtitle {
            font-size: clamp(1rem, 3vw, 1.5rem);
            font-weight: 300;
            color: var(--text-light);
            margin-bottom: max(20px, 4vh);
            letter-spacing: 1px;
        }

        .menu-buttons {
            display: flex;
            flex-direction: column;
            gap: max(15px, 2vh);
            width: 100%;
            max-width: 350px;
            margin: 0 auto;
        }

        .menu-btn, .form-btn {
            padding: max(10px, 1.5vh) 18px;
            font-size: clamp(0.9rem, 2.2vw, 1.1rem);
            font-weight: 600;
            color: var(--text-light);
            background: var(--card-bg);
            border: 1px solid var(--card-border);
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
            backdrop-filter: blur(5px);
        }

        .menu-btn.primary, .form-btn {
            background: linear-gradient(45deg, var(--secondary-color), var(--primary-color));
            border: none;
            box-shadow: 0 0 15px var(--shadow-light), 0 0 15px var(--shadow-dark);
        }

        .menu-btn:hover, .form-btn:hover {
            transform: translateY(-5px) scale(1.05);
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.2);
        }
        
        .menu-btn.primary:hover, .form-btn:hover {
             box-shadow: 0 0 25px var(--shadow-light), 0 0 25px var(--shadow-dark);
        }
        
        .form-btn:disabled {
            opacity: 0.7;
            cursor: not-allowed;
            transform: none;
        }

        .game-header {
            width: 100%;
            flex-shrink: 0;
            position: relative;
            z-index: 50;
        }

        .game-header h1 {
            font-size: clamp(1.2rem, 4vw, 2rem);
            margin-bottom: 1vh;
        }
        
        .stats-container {
            display: flex;
            justify-content: space-around;
            align-items: center;
            flex-wrap: wrap;
            gap: clamp(10px, 3vw, 20px);
            width: 100%;
            max-width: 800px;
            margin: 0 auto;
            padding: 8px;
            background: var(--card-bg);
            border-radius: 12px;
            font-size: clamp(0.75rem, 2.5vw, 1rem);
        }

        .timer-moves-row { display: flex; gap: 20px; flex-grow: 1; justify-content: center; }
        .player-turn { font-weight: bold; }
        #current-player.player1 { color: var(--player1-color); }
        #current-player.player2 { color: var(--player2-color); }
        .powered-by { display: flex; align-items: center; justify-content: center; }
        
        .game-container {
            width: 100%;
            flex-grow: 1;
            display: flex;
            justify-content: center;
            align-items: center;
            position: relative;
            min-height: 0;
        }

        .cards-container {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            grid-template-rows: repeat(5, 1fr);
            gap: clamp(4px, 1.5vmin, 8px);
            width: 100%;
            max-width: 500px; /* Limite para pantallas anchas */
            max-height: 100%;
            aspect-ratio: 4 / 5;
            margin: 0 auto;
            position: relative;
            transition: opacity 0.3s ease-in-out;
        }
        
        .card {
            aspect-ratio: 1 / 1;
            perspective: 1000px;
            background-color: transparent;
            border: none;
            cursor: pointer;
            animation: float 6s ease-in-out infinite;
            transform-style: preserve-3d;
            transition: opacity 0.3s ease-in-out, transform 0.5s ease-in-out;
        }

        .card-inner { position: relative; width: 100%; height: 100%; transition: transform 0.6s; transform-style: preserve-3d; }
        .card.flipped .card-inner { transform: rotateY(180deg); }

        .card-front, .card-back {
            position: absolute;
            width: 100%;
            height: 100%;
            -webkit-backface-visibility: hidden;
            backface-visibility: hidden;
            border-radius: clamp(5px, 2vmin, 10px);
            display: flex;
            justify-content: center;
            align-items: center;
            background: var(--card-bg);
            border: 1px solid var(--card-border);
            backdrop-filter: blur(5px);
            transition: transform 0.6s, background-color 0.3s ease-in-out;
            overflow: hidden;
        }
        .card-front { background: linear-gradient(135deg, rgba(255, 255, 255, 0.1), rgba(255, 255, 255, 0)); }
        .card-logo { width: 70%; height: 70%; object-fit: contain; filter: drop-shadow(0 0 5px rgba(255, 255, 255, 0.5)); }
        .card-back { transform: rotateY(180deg); font-size: clamp(1rem, 10vmin, 2.5rem); padding: 10%; }
        .card-back img { width: 85%; height: 85%; object-fit: contain; }
        .card.matched .card-inner { animation: match-animation 0.5s forwards; }

        @keyframes match-animation { 0% { transform: rotateY(180deg) scale(1); } 50% { transform: rotateY(180deg) scale(1.2); } 100% { transform: rotateY(180deg) scale(1); opacity: 0.5; } }
        @keyframes float { 0% { transform: translateY(0px); } 50% { transform: translateY(-10px); } 100% { transform: translateY(0px); } }
        
        .game-controls { width: 100%; display: flex; justify-content: center; flex-wrap: wrap; gap: 10px; padding-top: 1vh; flex-shrink: 0; }
        .control-btn { padding: 8px 16px; font-size: clamp(0.8rem, 1.8vw, 1rem); background: var(--card-bg); border: 1px solid var(--card-border); color: var(--text-light); border-radius: 10px; cursor: pointer; transition: all 0.3s ease; }
        .control-btn:hover { background: var(--primary-color); }
        #mute-btn { padding: 8px; width: 40px; height: 40px; display: flex; justify-content: center; align-items: center; }
        #mute-btn svg { width: 100%; height: 100%; fill: var(--text-light); }
        .modal { background: rgba(0, 0, 0, 0.7); display: none; }
        .modal.active { display: flex; }
        .modal-content { background: rgba(20, 20, 40, 0.8); padding: clamp(20px, 5vw, 40px); border-radius: 20px; backdrop-filter: blur(15px); border: 1px solid var(--card-border); width: 90%; max-width: 500px; text-align: center; animation: modal-pop 0.3s ease-out; }
        @keyframes modal-pop { from { transform: scale(0.8); opacity: 0; } to { transform: scale(1); opacity: 1; } }
        .emoji-large { font-size: clamp(3rem, 10vw, 5rem); margin-bottom: 15px; height: clamp(4rem, 12vw, 6rem); display: flex; justify-content: center; align-items: center; }
        .emoji-large img { max-width: 100%; max-height: 100%; object-fit: contain; }
        .modal-content h2 { font-size: clamp(1.5rem, 4vw, 2rem); margin-bottom: 15px; color: var(--text-light); }
        .modal-content p { font-size: clamp(0.9rem, 2.5vw, 1.1rem); margin-bottom: 25px; color: var(--text-dark); line-height: 1.6; }
        .continue-btn { padding: 12px 30px; font-size: clamp(1rem, 2.5vw, 1.2rem); font-weight: 600; color: var(--text-light); background: linear-gradient(45deg, var(--secondary-color), var(--primary-color)); border: none; border-radius: 12px; cursor: pointer; transition: all 0.3s ease; box-shadow: 0 0 15px var(--shadow-light); }
        .continue-btn:hover { transform: scale(1.05); box-shadow: 0 0 25px var(--shadow-light); }
        .win-screen { background: rgba(0, 0, 0, 0.7); }
        .win-content { animation: modal-pop 0.5s cubic-bezier(0.68, -0.55, 0.27, 1.55); }
        #win-title { font-size: clamp(2.5rem, 8vw, 4rem); color: #fdd835; text-shadow: 0 0 20px #fdd835; }
        #win-stats { margin: 20px 0; font-size: clamp(1rem, 3vw, 1.2rem); }
        .win-buttons { display: flex; gap: 20px; margin-top: 20px; }
        #confetti-canvas { position: fixed; top: 0; left: 0; width: 100%; height: 100%; z-index: 1000; pointer-events: none; }
        .emprendimiento-modal { display: none; }

        /* Registration Form Styles */
        .registration-form { display: flex; flex-direction: column; gap: 15px; width: 100%; }
        .form-group { text-align: left; }
        .form-group label { display: block; margin-bottom: 5px; font-size: 0.9rem; color: var(--text-dark); }
        .form-group label span { color: #e74c3c; }
        .form-group input { width: 100%; padding: 12px; background: rgba(0,0,0,0.2); border: 1px solid var(--card-border); border-radius: 8px; color: var(--text-light); font-size: 1rem; }
        #registration-message { margin-top: 10px; color: #fdd835; min-height: 20px; }
        
        /* Shuffle Animation */
        #shuffle-animation-container { position: absolute; width: 100%; height: 100%; top: 0; left: 0; perspective: 1500px; z-index: 100; pointer-events: none; display: none; overflow: hidden; }
        .shuffle-card { position: absolute; width: 15%; aspect-ratio: 1 / 1; top: 50%; left: 50%; transform: translate(-50%, -50%); border-radius: 10px; background: linear-gradient(135deg, rgba(255, 255, 255, 0.1), rgba(255, 255, 255, 0)); border: 1px solid var(--card-border); display: flex; justify-content: center; align-items: center; transform-style: preserve-3d; }
        .shuffle-card .card-logo { width: 70%; height: 70%; }
        .shuffle-card.shuffling { animation: card-cascade 1.5s cubic-bezier(0.6, 0.04, 0.98, 0.335) forwards; }
        @keyframes card-cascade {
            0% { transform: translate(-50%, -200%) rotateX(0deg) rotateY(0deg) rotateZ(0deg); opacity: 0; }
            25% { transform: translate(-50%, -50%) rotateX(var(--rx)) rotateY(var(--ry)) rotateZ(var(--rz)); opacity: 1; }
            75% { transform: translate(-50%, -50%) rotateX(calc(var(--rx) * 2)) rotateY(calc(var(--ry) * 2)) rotateZ(calc(var(--rz) * 2)); opacity: 1; }
            100% { transform: translate(var(--tx), var(--ty)) rotateX(0deg) rotateY(0deg) rotateZ(0deg) scale(0); opacity: 0; }
        }

        /* Celebration Rain */
        #celebration-rain-container { position: fixed; top: 0; left: 0; width: 100%; height: 100%; overflow: hidden; z-index: 999; pointer-events: none; }
        .falling-item { position: absolute; top: -10%; animation: fall 5s linear forwards; font-size: 2rem; user-select: none; }
        .falling-item img { width: 50px; height: 50px; object-fit: contain; }
        @keyframes fall { to { transform: translateY(110vh) rotate(360deg); opacity: 0; } }
    </style>
</head>

<body>
    <canvas id="confetti-canvas"></canvas>
    <div id="particles-js"></div>
    <div class="dynamic-gradient"></div>
    <div id="celebration-rain-container"></div>

    <!-- Registration Screen -->
    <div id="registration-screen" class="registration-screen" style="display: none;">
        <div class="menu-content">
            <h1 class="game-title" style="font-size: clamp(2rem, 6vw, 3.5rem);">Registro</h1>
            <p class="game-subtitle" style="margin-bottom: 20px;">Reg√≠strate una vez para jugar</p>
            <form id="registration-form" class="registration-form">
                <div class="form-group"><label for="fullName">Nombre completo <span>*</span></label><input type="text" id="fullName" name="Nombre completo" required></div>
                <div class="form-group"><label for="email">Correo electr√≥nico <span>*</span></label><input type="email" id="email" name="Correo electronico" required></div>
                <div class="form-group"><label for="city">Ciudad <span>*</span></label><input type="text" id="city" name="Ciudad" required></div>
                <div class="form-group"><label for="phone">Tel√©fono (Opcional)</label><input type="tel" id="phone" name="Telefono"></div>
                <div class="form-group"><label for="organization">Escuela/Empresa (Opcional)</label><input type="text" id="organization" name="Organismo"></div>
                <button type="submit" id="register-btn" class="form-btn">Registrarse y Jugar</button>
                <p id="registration-message"></p>
            </form>
        </div>
    </div>

    <!-- Main Menu -->
    <div id="main-menu" class="main-menu" style="display: none;"><div class="menu-content"><h1 class="game-title">ReConecta</h1><p class="game-subtitle">No caigas en las redes</p><p style="color: rgba(255,255,255,0.85); font-size: clamp(0.9rem, 2.5vw, 1.2rem); font-weight: 600; margin-bottom: max(15px, 3vh); letter-spacing: 1px;"><img src="https://images4.imagebam.com/f0/cd/a5/ME15BG8X_o.png" alt="Powered by PluralesMX" style="height: clamp(20px, 3vw, 30px); width: auto; object-fit: contain;"></p><div class="menu-buttons"><button id="single-player-btn" class="menu-btn primary">1 Jugador</button><button id="two-players-btn" class="menu-btn">2 Jugadores</button><button id="emprendimiento-btn" class="menu-btn">Modo Emprendimiento</button></div></div></div>
    
    <!-- Emprendimiento Menu -->
    <div id="emprendimiento-modal" class="modal emprendimiento-modal"><div class="menu-content emprendimiento-content"><h1 class="game-title">ReConecta Emprendimiento</h1><p class="game-subtitle">Construye tu legado digital</p><div class="menu-buttons"><button id="emp-single-btn" class="menu-btn primary">1 Jugador</button><button id="emp-two-btn" class="menu-btn">2 Jugadores</button><button id="emp-back-btn" class="menu-btn">Volver</button></div></div></div>

    <!-- Game Screen -->
    <div id="game-screen" class="game-screen" style="display: none;">
        <header class="game-header"><h1 id="game-mode-title">ReConecta</h1><div class="stats-container"><div class="timer-moves-row"><div class="timer">Tiempo: <span id="timer">00:00</span></div><div class="moves">Movimientos: <span id="moves">0</span></div></div><div id="player-turn" class="player-turn" style="display: none;">Turno: <span id="current-player">Jugador 1</span></div><div class="powered-by"><img src="https://images4.imagebam.com/f0/cd/a5/ME15BG8X_o.png" alt="Powered by PluralesMX" style="height: clamp(18px, 2.5vw, 25px); width: auto; object-fit: contain;"></div></div><div class="game-controls"><button id="back-menu-btn" class="control-btn">Men√∫</button><button id="restart-btn" class="control-btn">Reiniciar</button><button id="shuffle-btn" class="control-btn">Barajear</button><button id="mute-btn" class="control-btn"><svg id="sound-on-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor"><path d="M3 9v6h4l5 5V4L7 9H3zm13.5 3c0-1.77-1.02-3.29-2.5-4.03v8.05c1.48-.73 2.5-2.25 2.5-4.02zM14 3.23v2.06c2.89.86 5 3.54 5 6.71s-2.11 5.85-5 6.71v2.06c4.01-.91 7-4.49 7-8.77s-2.99-7.86-7-8.77z"></path></svg><svg id="sound-off-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" style="display: none;"><path d="M16.5 12c0-1.77-1.02-3.29-2.5-4.03v2.21l2.45 2.45c.03-.2.05-.41.05-.63zm2.5 0c0 .94-.2 1.82-.54 2.64l1.51 1.51C20.63 14.91 21 13.5 21 12c0-4.28-2.99-7.86-7-8.77v2.06c2.89.86 5 3.54 5 6.71zM4.27 3L3 4.27 7.73 9H3v6h4l5 5v-6.73l4.25 4.25c-.67.52-1.42.93-2.25 1.18v2.06c1.38-.31 2.63-.95 3.69-1.81L19.73 21 21 19.73l-9-9L4.27 3zM12 4L9.91 6.09 12 8.18V4z"></path></svg></button></div></header>
        <main class="game-container">
            <div id="shuffle-animation-container"></div>
            <div id="cards-container" class="cards-container"></div>
        </main>
    </div>

    <!-- Modals -->
    <div id="pair-modal" class="modal"><div class="modal-content"><div class="emoji-large" id="pair-emoji"></div><h2 id="pair-title"></h2><p id="pair-description"></p><button id="continue-btn" class="continue-btn">Continuar</button></div></div>
    <div id="win-screen" class="win-screen" style="display: none;"><div class="win-content"><h2 id="win-title">¬°Felicidades!</h2><p id="win-message"></p><div id="win-stats"><p id="win-time"></p><p id="win-moves"></p></div><div class="win-buttons"><button id="play-again-btn" class="control-btn">Jugar de Nuevo</button><button id="back-menu-win-btn" class="control-btn">Men√∫ Principal</button></div></div></div>

    <script src="https://cdn.jsdelivr.net/particles.js/2.0.0/particles.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.5.1/dist/confetti.browser.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/tone/14.7.77/Tone.js"></script>
    
    <script type="module">
        document.addEventListener('DOMContentLoaded', () => {
            const SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbxfBj_Jx-7IgZWqJLyc3mppm2pciRj8ZxpPFN2pBnIulvQ0kTcs2RZPBcpGm97iECb9RA/exec'; 
            
            const registrationScreen = document.getElementById('registration-screen');
            const registrationForm = document.getElementById('registration-form');
            const registerBtn = document.getElementById('register-btn');
            const registrationMessage = document.getElementById('registration-message');
            const mainMenu = document.getElementById('main-menu');
            const shuffleAnimationContainer = document.getElementById('shuffle-animation-container');
            const celebrationRainContainer = document.getElementById('celebration-rain-container');
            
            function checkRegistration() {
                if (localStorage.getItem('reconectaUserRegistered') === 'true') {
                    showMainMenuScreen();
                } else {
                    registrationScreen.style.display = 'flex';
                    document.body.classList.add('menu-active');
                    if (SCRIPT_URL === 'URL_DE_TU_SCRIPT_AQU√ç' || !SCRIPT_URL) {
                        registerBtn.disabled = true;
                        registrationMessage.textContent = 'ERROR: La URL del script no est√° configurada.';
                        registrationMessage.style.color = '#e74c3c';
                    }
                }
            }
            
            function showMainMenuScreen() {
                registrationScreen.style.display = 'none';
                mainMenu.style.display = 'flex';
                document.body.classList.add('menu-active');
            }
            
            registrationForm.addEventListener('submit', (e) => {
                e.preventDefault();
                registerBtn.disabled = true;
                registerBtn.textContent = 'Registrando...';
                registrationMessage.textContent = '';
                
                fetch(SCRIPT_URL, { method: 'POST', body: new FormData(registrationForm)})
                    .then(response => response.json())
                    .then(data => {
                        if(data.result === 'success' || data.result === 'duplicate') {
                            localStorage.setItem('reconectaUserRegistered', 'true');
                            registrationMessage.textContent = '¬°Registro exitoso! Iniciando...';
                            setTimeout(() => {
                                registrationScreen.style.opacity = '0';
                                setTimeout(() => showMainMenuScreen(), 500);
                            }, 1000);
                        } else { throw new Error(data.error || 'Error desconocido'); }
                    })
                    .catch(error => {
                        registrationMessage.textContent = 'Error en el registro. Intenta de nuevo.';
                        registrationMessage.style.color = '#e74c3c';
                        console.error('Error!', error.message);
                    })
                    .finally(() => {
                        registerBtn.disabled = false;
                        registerBtn.textContent = 'Registrarse y Jugar';
                    });
            });

            const cardData = [ { id: 1, emoji: 'üß†', title: 'Cerebro', description: 'Piensa antes de publicar...', color: '#2ecc71' }, { id: 2, emoji: 'üîí', title: 'Candado cerrado', description: 'Activa la verificaci√≥n en dos pasos...', color: '#3498db' }, { id: 3, emoji: '‚õî', title: 'Direcci√≥n Prohibida', description: 'Compartir memes ofensivos es acoso.', color: '#f1c40f' }, { id: 4, emoji: '‚ö†Ô∏è', title: 'Advertencia', description: 'Si ves contenido sensible, rep√≥rtalo.', color: '#e67e22' }, { id: 5, emoji: 'üåê', title: 'Globo Terr√°queo', description: 'Verifica que los sitios web tengan ‚Äòhttps‚Äô.', color: '#9b59b6' }, { id: 6, emoji: 'üì∑', title: 'C√°mara', description: 'Nunca compartas fotos √≠ntimas.', color: '#f1c40f' }, { id: 7, emoji: 'üíª', title: 'Ordenador', description: 'No descargues archivos de fuentes dudosas.', color: '#d35400' }, { id: 8, emoji: 'üë•', title: 'Siluetas', description: 'Cuidado con perfiles falsos.', color: '#e74c3c' }, { id: 9, emoji: 'üëÅÔ∏è', title: 'Ojo', description: 'Revisa tu configuraci√≥n de privacidad.', color: '#3498db' }, { id: 10, emoji: 'üìÑ', title: 'P√°gina', description: 'No compartas datos personales.', color: '#f39c12' }, ];
            const emprendimientoCardData = [ { id: 1, image: 'https://images4.imagebam.com/57/c0/40/ME15DZ92_o.png', title: 'Pivotar', description: 'Cambiar la estrategia de negocio...', color: '#27ae60' }, { id: 2, image: 'https://images4.imagebam.com/2e/f6/c1/ME15DZL5_o.png', title: 'Capital Semilla', description: 'Dinero inicial para arrancar tu idea.', color: '#16a085' }, { id: 3, image: 'https://images4.imagebam.com/13/c8/45/ME15DZM7_o.png', title: 'Marketing Digital', description: 'Promoci√≥n online para llegar a m√°s clientes.', color: '#f39c12' }, { id: 4, image: 'https://images4.imagebam.com/34/74/6c/ME15DZNC_o.png', title: 'Liderazgo', description: 'Habilidad de inspirar y guiar a un equipo.', color: '#f1c40f' }, { id: 5, image: 'https://images4.imagebam.com/23/e4/3b/ME15DZUE_o.png', title: 'Aliado Estrat√©gico', description: 'Un socio clave que potencia tu negocio.', color: '#2980b9' }, { id: 6, image: 'https://images4.imagebam.com/be/9f/d3/ME15DZXC_o.png', title: 'Pitch', description: 'Presentaci√≥n breve para atraer inversionistas.', color: '#2ecc71' }, { id: 7, image: 'https://images4.imagebam.com/90/46/20/ME15E03L_o.png', title: 'Competencia', description: 'Otras empresas en tu mismo mercado.', color: '#e67e22' }, { id: 8, image: 'https://images4.imagebam.com/2b/f3/8a/ME15E07K_o.png', title: 'Estrategia', description: 'El plan de acci√≥n para lograr tus objetivos.', color: '#d35400' }, { id: 9, image: 'https://images4.imagebam.com/b6/03/e0/ME15E08K_o.png', title: 'Networking', description: 'Conectar con personas para crear oportunidades.', color: '#3498db' }, { id: 10, image: 'https://images4.imagebam.com/49/d8/85/ME15E09N_o.png', title: 'Plan de Negocios', description: 'Documento que describe c√≥mo funcionar√° tu empresa.', color: '#8e44ad' }, ];

            particlesJS('particles-js', { particles: { number: { value: 80, density: { enable: true, value_area: 800 } }, color: { value: "#ffffff" }, shape: { type: "circle" }, opacity: { value: 0.5 }, size: { value: 3, random: true }, line_linked: { enable: true, distance: 150, color: "#ffffff", opacity: 0.4 }, move: { enable: true, speed: 2, direction: "none", out_mode: "out" } }, interactivity: { events: { onhover: { enable: true, mode: "repulse" }, onclick: { enable: true, mode: "push" } }, modes: { repulse: { distance: 100 }, push: { particles_nb: 4 } } } });
            const gradient = document.querySelector('.dynamic-gradient');
            document.addEventListener('mousemove', (e) => { const { clientX: x, clientY: y } = e; const { innerWidth: w, innerHeight: h } = window; gradient.style.setProperty('--x', `${(x / w) * 100}%`); gradient.style.setProperty('--y', `${(y / h) * 100}%`); });

            const gameScreen = document.getElementById('game-screen'), winScreen = document.getElementById('win-screen'), cardsContainer = document.getElementById('cards-container'), movesSpan = document.getElementById('moves'), timerSpan = document.getElementById('timer'), pairModal = document.getElementById('pair-modal'), singlePlayerBtn = document.getElementById('single-player-btn'), twoPlayersBtn = document.getElementById('two-players-btn'), playerTurnDiv = document.getElementById('player-turn'), currentPlayerSpan = document.getElementById('current-player'), gameModeTitle = document.getElementById('game-mode-title'), emprendimientoBtn = document.getElementById('emprendimiento-btn'), emprendimientoModal = document.getElementById('emprendimiento-modal'), empSingleBtn = document.getElementById('emp-single-btn'), empTwoBtn = document.getElementById('emp-two-btn'), empBackBtn = document.getElementById('emp-back-btn');
            
            let flippedCards = [], matchedPairs = 0, moves = 0, timerInterval, seconds = 0, currentPlayer = 1, isGameActive = false, isTwoPlayerMode = false, isEmprendimientoMode = false, playerScores = { 1: 0, 2: 0 }, isMuted = false, isAudioInitialized = false, rainInterval;
            const synth = new Tone.PolySynth(Tone.Synth, { oscillator: { type: "sine" }, envelope: { attack: 0.005, decay: 0.1, sustain: 0.3, release: 1 } }).toDestination();
            const ambientSynth = new Tone.FMSynth({ harmonicity: 3, modulationIndex: 10, oscillator: { type: "sine" }, envelope: { attack: 2, decay: 1, sustain: 1, release: 2 }, modulation: { type: "square" }, modulationEnvelope: { attack: 2, decay: 1, sustain: 1, release: 2 } }).toDestination();
            let musicLoop;

            function playSound(note, d = '8n') { if (!isMuted && isAudioInitialized) synth.triggerAttackRelease(note, d); }
            async function initializeAudio() { if (!isAudioInitialized) { await Tone.start(); isAudioInitialized = true; } if (Tone.Transport.state !== "started") Tone.Transport.start(); if (!isMuted) playBackgroundMusic(); }
            function playBackgroundMusic() { if (isMuted || !isAudioInitialized) return; if (musicLoop) musicLoop.stop(0).dispose(); const notes = ["C2", "G2", "D3", "A3", "E3"]; musicLoop = new Tone.Loop(t => { ambientSynth.triggerAttackRelease(notes[Math.floor(Math.random() * notes.length)], "2m", t); }, "1m").start(0); }
            function stopBackgroundMusic() { if (musicLoop) { musicLoop.stop(0).dispose(); musicLoop = null; } }
            
            document.getElementById('mute-btn').addEventListener('click', () => { isMuted = !isMuted; Tone.Destination.mute = isMuted; document.getElementById('sound-on-icon').style.display = isMuted ? 'none' : 'block'; document.getElementById('sound-off-icon').style.display = isMuted ? 'block' : 'none'; if (isMuted) stopBackgroundMusic(); else if (isGameActive) playBackgroundMusic(); });
            
            singlePlayerBtn.addEventListener('click', () => startGame(false, false));
            twoPlayersBtn.addEventListener('click', () => startGame(true, false));
            emprendimientoBtn.addEventListener('click', () => { playSound('E4'); mainMenu.style.display = 'none'; emprendimientoModal.style.display = 'flex'; });
            empSingleBtn.addEventListener('click', () => startGame(false, true));
            empTwoBtn.addEventListener('click', () => startGame(true, true));
            empBackBtn.addEventListener('click', () => { playSound('C4'); emprendimientoModal.style.display = 'none'; mainMenu.style.display = 'flex'; });

            function startGame(isTwoPlayer, isEmprendimiento) {
                initializeAudio(); playSound('G4', '4n');
                document.body.classList.toggle('menu-active', !isEmprendimiento);
                isGameActive = true; isTwoPlayerMode = isTwoPlayer; isEmprendimientoMode = isEmprendimiento;
                gameModeTitle.textContent = isEmprendimientoMode ? 'ReConecta Emprendimiento' : 'ReConecta';
                mainMenu.style.display = 'none'; emprendimientoModal.style.display = 'none';
                gameScreen.style.display = 'flex';
                setTimeout(() => gameScreen.style.opacity = 1, 50);
                playerTurnDiv.style.display = isTwoPlayerMode ? 'block' : 'none';
                resetGame();
            }
            
            function createBoard() {
                cardsContainer.innerHTML = ''; let currentCards = isEmprendimientoMode ? emprendimientoCardData : cardData;
                let deck = [...currentCards, ...currentCards];
                deck.sort(() => Math.random() - 0.5);
                deck.forEach(cardData => { const cardEl = document.createElement('button'); cardEl.className = 'card'; cardEl.dataset.id = cardData.id; cardEl.innerHTML = `<div class="card-inner"><div class="card-front"><img src="https://images4.imagebam.com/c5/d7/3a/ME15BFGA_o.png" alt="Logo" class="card-logo"></div><div class="card-back" style="background-color:${cardData.color};">${isEmprendimientoMode ? `<img src="${cardData.image}" alt="${cardData.title}">` : cardData.emoji}</div></div>`; cardEl.addEventListener('click', () => flipCard(cardEl)); cardsContainer.appendChild(cardEl); });
            }

            function flipCard(cardEl) { if (flippedCards.length < 2 && !cardEl.classList.contains('flipped') && !cardEl.classList.contains('matched')) { playSound('C4'); cardEl.classList.add('flipped'); flippedCards.push(cardEl); if (flippedCards.length === 2) { moves++; movesSpan.textContent = moves; setTimeout(checkForMatch, 1000); } } }
            
            function checkForMatch() {
                const [c1, c2] = flippedCards;
                if (c1.dataset.id === c2.dataset.id) {
                    playSound('G5', '8n'); launchPairConfetti(); c1.classList.add('matched'); c2.classList.add('matched'); matchedPairs++;
                    if (isTwoPlayerMode) playerScores[currentPlayer]++;
                    const cardSet = isEmprendimientoMode ? emprendimientoCardData : cardData;
                    const info = cardSet.find(c => c.id == c1.dataset.id);
                    document.getElementById('pair-emoji').innerHTML = isEmprendimientoMode ? `<img src="${info.image}" alt="${info.title}">` : info.emoji;
                    document.getElementById('pair-title').textContent = info.title;
                    document.getElementById('pair-description').textContent = info.description;
                    pairModal.classList.add('active');
                    if (matchedPairs === cardSet.length) { stopTimer(); setTimeout(showWinScreen, 500); }
                } else { playSound('A3', '8n'); c1.classList.remove('flipped'); c2.classList.remove('flipped'); if (isTwoPlayerMode) { currentPlayer = currentPlayer === 1 ? 2 : 1; updatePlayerTurn(); } }
                flippedCards = [];
            }
            
            function triggerShuffleAnimation() {
                playSound('C3', '2n');
                cardsContainer.style.opacity = '0';
                shuffleAnimationContainer.innerHTML = '';
                shuffleAnimationContainer.style.display = 'block';
                for (let i = 0; i < 20; i++) {
                    const sc = document.createElement('div'); sc.className = 'shuffle-card';
                    sc.innerHTML = `<img src="https://images4.imagebam.com/c5/d7/3a/ME15BFGA_o.png" alt="Logo" class="card-logo">`;
                    sc.style.setProperty('--rx', `${Math.random()*720-360}deg`); sc.style.setProperty('--ry', `${Math.random()*720-360}deg`); sc.style.setProperty('--rz', `${Math.random()*720-360}deg`); sc.style.setProperty('--tx', `${Math.random()*200-100}vw`); sc.style.setProperty('--ty', `${Math.random()*200-100}vh`);
                    setTimeout(() => sc.classList.add('shuffling'), i * 20);
                    shuffleAnimationContainer.appendChild(sc);
                }
                setTimeout(() => { resetGame(); shuffleAnimationContainer.style.display = 'none'; cardsContainer.style.opacity = '1'; }, 1500);
            }
            
            document.getElementById('continue-btn').addEventListener('click', () => { playSound('E4'); pairModal.classList.remove('active'); });
            function startTimer() { timerInterval = setInterval(() => { seconds++; timerSpan.textContent = `${String(Math.floor(seconds/60)).padStart(2,'0')}:${String(seconds%60).padStart(2,'0')}`; }, 1000); }
            function stopTimer() { clearInterval(timerInterval); }
            function resetTimer() { stopTimer(); seconds = 0; timerSpan.textContent = '00:00'; }
            function showWinScreen() { playSound('C6', '1n'); stopBackgroundMusic(); startConfetti(); startCelebrationRain(); document.getElementById('win-time').textContent = `Tiempo: ${timerSpan.textContent}`; document.getElementById('win-moves').textContent = `Movimientos: ${moves}`; winScreen.style.display = 'flex'; if (isTwoPlayerMode) { document.getElementById('win-message').textContent = playerScores[1] > playerScores[2] ? `¬°Gana el Jugador 1 con ${playerScores[1]} pares!` : playerScores[2] > playerScores[1] ? `¬°Gana el Jugador 2 con ${playerScores[2]} pares!` : `¬°Es un empate!`; } else { document.getElementById('win-message').textContent = 'Has completado el juego'; } }
            
            function backToMenu() { playSound('C4'); stopBackgroundMusic(); if (Tone.Transport.state === "started") { Tone.Transport.stop(); Tone.Transport.cancel(); } isGameActive = false; gameScreen.style.opacity = 0; winScreen.style.display = 'none'; stopConfetti(); stopCelebrationRain(); setTimeout(() => { gameScreen.style.display = 'none'; mainMenu.style.display = 'flex'; setTimeout(() => mainMenu.style.opacity = 1, 50); document.body.classList.add('menu-active'); }, 500); }
            function resetGame() { if (!isMuted && isAudioInitialized && isGameActive) playBackgroundMusic(); flippedCards = []; matchedPairs = 0; moves = 0; movesSpan.textContent = 0; resetTimer(); startTimer(); createBoard(); currentPlayer = 1; playerScores = { 1: 0, 2: 0 }; if (isTwoPlayerMode) updatePlayerTurn(); }
            
            document.getElementById('restart-btn').addEventListener('click', resetGame);
            document.getElementById('shuffle-btn').addEventListener('click', triggerShuffleAnimation);
            document.getElementById('back-menu-btn').addEventListener('click', backToMenu);
            document.getElementById('play-again-btn').addEventListener('click', () => { winScreen.style.display = 'none'; stopConfetti(); stopCelebrationRain(); startGame(isTwoPlayerMode, isEmprendimientoMode); });
            document.getElementById('back-menu-win-btn').addEventListener('click', backToMenu);
            
            function updatePlayerTurn() { currentPlayerSpan.textContent = `Jugador ${currentPlayer}`; currentPlayerSpan.className = `player${currentPlayer}`; }
            
            // --- EFECTOS DE CELEBRACI√ìN ---
            const myConfetti = confetti.create(document.getElementById('confetti-canvas'), { resize: true, useWorker: true });
            let confettiInterval;
            function launchPairConfetti() { myConfetti({ particleCount: 100, spread: 70, origin: { y: 0.6 } }); }
            function startConfetti() { const duration = 5 * 1000; const animationEnd = Date.now() + duration; const defaults = { startVelocity: 30, spread: 360, ticks: 60, zIndex: 0 }; function randomInRange(min, max) { return Math.random() * (max - min) + min; } confettiInterval = setInterval(function() { const timeLeft = animationEnd - Date.now(); if (timeLeft <= 0) return clearInterval(confettiInterval); const particleCount = 50 * (timeLeft / duration); myConfetti(Object.assign({}, defaults, { particleCount, origin: { x: randomInRange(0.1, 0.3), y: Math.random() - 0.2 } })); myConfetti(Object.assign({}, defaults, { particleCount, origin: { x: randomInRange(0.7, 0.9), y: Math.random() - 0.2 } })); }, 250); }
            function stopConfetti() { clearInterval(confettiInterval); }
            
            function startCelebrationRain() { stopCelebrationRain(); const items = isEmprendimientoMode ? emprendimientoCardData.map(c => c.image) : cardData.map(c => c.emoji); rainInterval = setInterval(() => { const item = document.createElement('div'); item.className = 'falling-item'; if (isEmprendimientoMode) { item.innerHTML = `<img src="${items[Math.floor(Math.random()*items.length)]}">`; } else { item.textContent = items[Math.floor(Math.random()*items.length)]; } item.style.left = `${Math.random()*100}vw`; item.style.animationDuration = `${Math.random()*2+3}s`; celebrationRainContainer.appendChild(item); setTimeout(() => { item.remove(); }, 5000); }, 200); }
            function stopCelebrationRain() { clearInterval(rainInterval); celebrationRainContainer.innerHTML = ''; }

            checkRegistration();
        });
    </script>
</body>
</html>
